!function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=323)}({1:function(e,t,n){"use strict";const a={setting:{level:"debug"},LOG_LEVELS:["debug","info","warning","error"],check:e=>a.LOG_LEVELS.indexOf(a.setting.level.toLowerCase())<=a.LOG_LEVELS.indexOf(e)};Object.defineProperty(a,"debug",{get:()=>a.check("debug")?console.debug.bind(window.console,"%cDEBUG:","color: #6c757d"):()=>{}}),Object.defineProperty(a,"info",{get:()=>a.check("info")?console.info.bind(window.console,"%cINFO:","color: #17a2b8"):()=>{}}),Object.defineProperty(a,"warning",{get:()=>a.check("warning")?console.warn.bind(window.console,"%cWARNING:","color: #ffc107"):()=>{}}),Object.defineProperty(a,"error",{get:()=>a.check("error")?console.error.bind(window.error,"%cERROR:","color: #dc3545"):()=>{}}),t.a=a},10:function(e,t,n){"use strict";var a=n(1);const r=["origin"],o={get:(e,t)=>{if("origin"===t)return e;let n=void 0;const r=localStorage["ori:"+t];try{n=r&&JSON.parse(r)}catch(e){return a.a.error("storage: parse json fail, key: ",t)}return n},set:(e,t,n)=>{if(-1!==r.indexOf(t))return a.a.error("storage: key can not use",t);const o=JSON.stringify(n);return localStorage["ori:"+t]=o,e[t]=n,n}},i=new Proxy({},o);t.a=i},14:function(e,t,n){"use strict";var a=n(1);const r={tasks:[],remove:e=>{const t=r.tasks.findIndex(t=>t.message===e);-1!==t&&(r.tasks.splice(t,1),r.next())},next:()=>{if(!window.prog_box||!window.prog_message)return a.a.debug("prog: missing prog dom");const e=r.tasks[r.tasks.length-1];if(!e)return void window.prog_box.addClass("prog-fade");window.prog_box.removeClass("prog-fade");const{message:t,timeout:n,option:o}=e;window.prog_message.innerHTML=t,window.prog_icon&&(o.icon?window.prog_icon.className="prog-icon fa fa-"+o.icon:window.prog_icon.className="prog-icon hidden"),n&&(setTimeout(()=>{r.remove(t)},n),e.timeout=!1)},push:(e,t,n={})=>{"string"==typeof n&&(n={icon:n}),r.tasks.push({message:e,timeout:t,option:n}),r.next()},success:(e,t=2e3)=>r.push(e,t,"check text-green"),error:(e,t=2e3)=>r.push(e,t,"times text-red")};t.a=r},2:function(e,t,n){"use strict";var a=n(1);class r{constructor(){this._eventPools=[],this.iid=`${Date.now()}${Math.random().toString().slice(2,6)}`}listen(e,t,n){if(!t)return a.a.error("event.listen: missing param handle");const r=this._eventPools.find(t=>t.name===e);if(r){const e=r.handles.find(e=>e.key===n);n&&e?e.handle=t:r.handles.push({key:n,handle:t})}else{const a={name:e,handles:[{key:n,handle:t}]};this._eventPools.push(a)}}emit(e,...t){const n=this._eventPools.find(t=>t.name===e);n&&n.handles.forEach(e=>e.handle(...t))}next(e,...t){"number"!=typeof e&&(t.unshift(e),e=0),setTimeout(()=>this.emit(...t),e)}}const o=new r;o.Event=r,t.a=o},31:function(e,t,n){"use strict";var a=n(2),r=n(14),o=n(9);const i={script:(e,t,n)=>{if(t)return Promise.resolve();let o=!1;n&&a.a.listen(n,()=>{o||r.a.error("Thư viện chưa được tại xong, hãy thử lại")}),"string"==typeof e&&(e=[e]);const i=[];return e.forEach(e=>{-1===e.indexOf("/")&&(e="/static/main/js/shards/"+e+".bundle.js?v=1");const t=document.createElement("script");t.src=e,i.push(new Promise((n,a)=>{t.onload=()=>{n(e)},t.onerror=()=>{a(e)}})),document.head.appendChild(t)}),Promise.all(i).then(()=>(o=!0,Promise.resolve()))},ui:(e,t)=>{const n=new a.a.Event;return fetch(e).then(e=>200!==e.status?e.json().then(({error:e})=>{throw e}):e.text()).then(async r=>{const i=document.createElement("div");i.innerHTML=r,a.a.next("main_include_ui_content_done"),n.next("main_include_ui_content_done");const s=i.querySelectorAll("script").toArray();s.forEach(e=>{e.parentNode.removeChild(e)}),t.appendChild(i),o.a.origin.watch();for(let t=0;t<s.length;t++){const n=s[t],a=document.createElement("script");a.setAttribute("ui-url",e),n.src?a.src=n.src:a.innerHTML=n.innerHTML,document.head.appendChild(a),!n.src||n.async||n.defer||await new Promise((e,t)=>{a.onload=e,a.onerror=t})}}).catch(t=>{window.content.innerHTML=`\n        <h3>${t.message}</h3>\n        Cố gắng lấy dữ liệu thất bại!<br>\n        Kiểm tra UI component <strong>${e}</strong>`})}};t.a=i},323:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n(2),o=n(31);const i={createCirleCall:(e=200)=>{const t={block:!1,handle:null,execute:(n,...a)=>{t.handle=n,t.block||(t.handle(...a),t.handle=null,t.block=!0,setTimeout(()=>{t.block=!1,t.handle&&t.execute(t.handle,...a)},e))}};return t},createTimeoutCall:(e=200,t,...n)=>{const r={};return r.timeout=e,r.fn=t,r.args=n,r.call_timeout=null,r.execute=e=>{if(e&&(r.fn=e),!r.fn)return a.a.error("util: createTimeoutCall: missing fn");clearTimeout(r.call_timeout),r.call_timeout=setTimeout(()=>{e(...r.args)},r.timeout)},r},getCookie:e=>{const t=e+"=",n=decodeURIComponent(document.cookie).split(";");for(let e=0,a=n.length;e<a;e++){let a=n[e];for(;" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(t))return a.substring(t.length,a.length)}return""},setCookie:(e,t,n=31104e6)=>{const a=new Date;a.setTime(a.getTime()+n);const r="expires="+a.toUTCString();document.cookie=e+"="+t+";"+r+";path=/"},export:(e,t,n)=>{const a=(e,t,n)=>{const a=XLSX.utils.book_new();a.Props={Title:"Export",Subject:"",...n},a.SheetNames.push("Sheet1"),a.Sheets.Sheet1=XLSX.utils.aoa_to_sheet(e),XLSX.writeFile(a,t+".xlsx",{bookType:"xlsx",bookSST:!1})};window.XLSX?a(e,t,n):o.a.script("https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.13.1/xlsx.full.min.js").then(()=>{a(e,t,n)})},encodeHTML:e=>{const t=window.document.createElement("textarea");return t.innerText=e||"",t.innerHTML.replace(/"/g,"&quot;")},decodeHTML:e=>{const t=window.document.createElement("textarea");return t.innerHTML=e,t.value},copy:e=>{const t=document.createElement("textarea");t.style="position:fixed; bottom: -50px",document.body.appendChild(t),t.value=e,t.select(),t.setSelectionRange(0,e.length),document.execCommand("copy"),document.body.removeChild(t)},tformat:e=>e?moment.utc(e).local().format("HH:mm DD/MM/YYYY"):"",uuid:()=>([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)),decodeJWT:e=>{if(!e)return;const t=e.split(".")[1].replaceAll("_","/").replaceAll("-","+"),n=atob(t).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join("");return JSON.parse(decodeURIComponent(n))},phonef:e=>e?e.replace("+84",0):"",diff:(e,t)=>{const n={};return Object.keys(t).forEach(a=>{const r=e[a],o=t[a];"object"==typeof o?JSON.stringify(r)!==JSON.stringify(o)&&(n[a]=[r,o]):r!==o&&(n[a]=[r,o])}),n}};var s=i,l=n(10);var c=()=>{a.a.info("init: initial script executed"),HTMLElement.prototype.addClass=function(e){new RegExp(`^${e}$|^${e} | ${e}$| ${e}( )`,"g").test(this.className)||(this.className=`${this.className} ${e}`.trim())},HTMLElement.prototype.removeClass=function(e){const t=new RegExp(`^${e}$|^${e} | ${e}$| ${e}( )`,"g");this.className=this.className.replace(t,"$1").trim()},HTMLCollection.prototype.toArray=function(){return[...this]},NodeList.prototype.toArray=function(){return[...this]},Number.prototype.separators=function(e=""){const t=this.toString().split("."),n=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),a=t[1];return a?n+"."+a+e:n+e},Number.prototype.int=function(){return Math.floor(this)},String.prototype.int=function(){return+this.replace(/[^0-9-]/g,"")},window.query={},window.user=s.decodeJWT(s.getCookie("token")),location.search.slice(1).split("&").forEach(e=>{const[t,n]=e.split("=");""!==t&&(window.query[t]=decodeURIComponent(n))}),window.screen_name=location.pathname.replace(/[0-9a-f]{24}/g,"").replace(/^\/+|\/+$/g,"").replace(/\/\//g,"/"),window.screen_instance=location.pathname.replace(/^\/+|\/+$/g,""),window.device_id=l.a.device_id||(l.a.device_id=s.uuid()),r.a.listen("socket_connected",()=>{const e=window.user||{};socket._io_client.emit("login",{id:e._id||"anonymous",username:e.username||"anonymous",email:e.email||"",avatar:e.avatar||"",href:location.href||""},e=>{r.a.emit("socket_logged_in",e),a.a.info("init: socket logged in")})})};const d={env:"loc"};"portal.dichung.vn"===location.hostname&&(d.env="pro");var u=d;const m={},p={};m.mounted=p,m.gen=(e,t)=>{if(m[e]||!/^[a-zA-Z][a-zA-Z0-9_]{0,63}$/.test(e))return a.a.error(`emitter: name "${e}" existed or invalid`);m[e]=()=>{if(p[e])return a.a.error("emitter: duplicate mount emitter "+e);t(),p[e]=!0}},m.gen("click",()=>{window.document.body.addEventListener("click",e=>{!function e(t,n,a=0){if(a>5||!t)return;const o=t.getAttribute("click-emit");if(!o)return e(t.parentElement,n,a+1);const i=o.split(":")[0];let s=o.split(":").slice(1).join(":");if("?"===s[0]){const e={};s.slice(1).split("&").forEach(t=>{const[n,a]=t.split("=");""!==n&&(e[n]=a)}),s=e}r.a.next(i,s,{target:t,domEvent:n})}(e.target,e)}),a.a.info("emiter: click emiter mounted")}),m.gen("scroll",()=>{let e=!1;window.addEventListener("scroll",t=>{e||(e=!0,window.requestAnimationFrame(()=>{r.a.next("window_scroll",t),e=!1}))}),a.a.info("emiter: add event window_scroll")}),m.gen("visit",()=>{let e=l.a.visitedPages||[];-1===e.indexOf(location.pathname)&&(r.a.next("first_time_vist_page",location.pathname),e.push(location.pathname),e=e.slice(-100),l.a.visitedPages=e),a.a.info("emiter: add event first_time_vist_page")}),m.gen("keyboard",()=>{const e=e=>{const t=e.target,n=t.getAttribute("mask");if(n)switch(n){case"money":t.value=t.value.replace(/^0+/,""),"-"!==t.value&&""!==t.value&&(t.value=(+t.value.replace(/[^0-9-]/g,"")).separators());break;case"money_positive":t.value=t.value.replace(/^0+/,""),""!==t.value&&(t.value=(+t.value.replace(/[^0-9]/g,"")).separators());break;case"number":t.value=t.value.replace(/^0+/,""),"-"!==t.value&&""!==t.value&&(t.value=t.value.replace(/[^0-9-.]/g,""));break;case"positive_number":t.value=t.value.replace(/^0+/,""),""!==t.value&&(t.value=t.value.replace(/[^0-9.]/g,""));break;case"phone":t.value=t.value.replace(/[^0-9+]/g,"");break;case"tag":t.value=t.value.replace(/[^a-zA-Z0-9 _]/g,"").replace(/ /g,"_");break;case"slug":t.value=t.value.replace(/[^a-zA-Z0-9 \-]/g,"").replace(/ /g,"-")}};window.document.body.addEventListener("keydown",e=>{const t=e.target,n=t.getAttribute("mask"),a=e.key;if(n&&1===a.length&&!e.ctrlKey&&!e.altKey&&!e.metaKey)switch(n){case"money":if("-"===a&&0!==e.target.value.length){e.preventDefault();break}/[^0-9-]/.test(a)&&e.preventDefault();break;case"money_positive":/[^0-9]/.test(a)&&e.preventDefault();break;case"number":if("."===a&&e.target.value.includes(".")){e.preventDefault();break}if("-"===a&&0!==e.target.value.length){e.preventDefault();break}/[^0-9-.]/.test(a)&&e.preventDefault();break;case"positive_number":if("."===a&&e.target.value.includes(".")){e.preventDefault();break}/[^0-9.]/.test(a)&&e.preventDefault();break;case"phone":(/[^0-9+]/.test(a)||t.value.length>11)&&e.preventDefault();break;case"tag":/[^a-zA-Z0-9 _]/.test(a)&&e.preventDefault();break;case"slug":/[^a-zA-Z0-9 \-]/.test(a)&&e.preventDefault();break;default:if("["===n[0]){new RegExp(n.slice(1)).test(a)||e.preventDefault()}}}),window.document.body.addEventListener("keyup",e),window.document.body.addEventListener("paste",e),r.a.listen("main_mask_scan",()=>()=>{document.querySelectorAll("[mask]").toArray().forEach(t=>{e({target:t})})}),a.a.info("emiter: keyboard emiter mounted")});var g=m,h=n(14),f=n(9);const v={push:(e,t,n="")=>{if(!e)return a.a.error("activity: missing message");n||(n="screen:"+window.screen_instance),k.post("/activity/v1/activities",{message:e,key:n,data:t}).catch(e=>a.a.error("activity: push activity error:",e))},get:({key:e,uid:t}={})=>(e||(e="screen:"+window.screen_instance),k.get("/activity/v1/activities",{key:e,uid:t}))};var b=v;const y={},w={prog:!0,apiBase:"/api",prefix:"",uiURL:"",header:{"Content-Type":"application/json"}};y.setting=w;const _=(e,t,n,a)=>{if(w.prog&&h.a.remove(a.progMessage||t.toLowerCase().replace(/\_/g," ")),a.btn){let e=[];e="string"==typeof a.btn?document.querySelectorAll(a.btn).toArray():[a.btn],e.forEach(e=>{e.removeClass("btn-loading")})}};y.ale=e=>{if(a.a.error(e),swal)return swal("",e.message||"unknow error","error")},y.fetch=({url:e,method:t,body:n,param:r,option:o})=>{o=o||{},e=e||"";const i={...o,method:t,headers:{...w.header,...o.header}};if(0!==Object.keys(f.a.layer).length&&(-1!==["get","head"].indexOf(t.toLowerCase())?r={...f.a.layer,...r||{}}:n={...f.a.layer,...n||{}}),n&&(i.body=JSON.stringify(n)),0!==e.indexOf("http")){const t=[w.apiBase];"/"!==e[0]&&t.push(w.prefix),t.push(e),e=t.join("/").replace(/\/\//g,"/")}return r&&(e+=0!==e.indexOf("?")?"?":"&",e+=Object.keys(r).filter(e=>void 0!==r[e]).map(e=>`${e}=${encodeURIComponent(r[e])}`).join("&")),a.a.info(`bus.fetch: ${t} ${e}`,n),((e,t,n,a)=>{if(w.prog&&h.a.push(a.progMessage||t.toLowerCase().replace(/\_/g," ")),a.btn){let e=[];e="string"==typeof a.btn?document.querySelectorAll(a.btn).toArray():[a.btn],e.forEach(e=>{e.addClass("btn-loading")})}})(0,"loading",0,o),e=o.url||e,fetch(e,i).then(e=>e.json()).then(e=>e.error?Promise.reject(e.error):(((e,t,n,a)=>{a.activity&&b.push(t,a.activity,{...f.a.layer,...n})})(0,"loading",n||r,o),_(0,"loading",0,o),Promise.resolve(e))).catch(e=>{throw _(0,"loading",0,o),e})},y.get=(e,t,n)=>y.fetch({method:"GET",url:e,param:t,option:n}),y.post=(e,t,n)=>y.fetch({method:"POST",url:e,body:t,option:n}),y.put=(e,t,n)=>y.fetch({method:"PUT",url:e,body:t,option:n}),y.patch=(e,t,n)=>y.fetch({method:"PATCH",url:e,body:t,option:n}),y.delete=(e,t,n)=>y.fetch({method:"DELETE",url:e,body:t,option:n}),y.ui=(e,t,n)=>y.fetch({method:"POST",url:`${w.uiURL}?_command=${e}`,body:t,option:n});var k=y;const x={get:e=>k.get("/activity/v1/configs",{key:e}).then(({data:e})=>Promise.resolve(e?e.value:void 0)),set:(e,t)=>k.post("/activity/v1/configs",{key:e,value:t}),table:e=>{const t={errors:[]},{name:n,target:o,fields:i}=e,l=n?n.replace(/:/g,"_"):s.uuid(),c=("configer_table_body_"+l).replace(/:/g,"_"),d=("configer_table_submit_"+l).replace(/:/g,"_"),u=(e=[],t)=>{const n=window[c];return void 0===t&&(t=n?n.getElementsByTagName("tr").length+1:1),e.map((e,n)=>{const a=t+n;let r=`<td>${a}</td>`;return r+=i.map((t,n)=>{let r=`<input value="${e[t.key]||""}" placeholder="...">`;return t.render&&(r=t.render({field:t,value:e[t.key],key:t.key,row:a,col:n,config_key:l})),`\n                <td class="configer-table-field">${r}</td>`}).join(""),r+=`<td click-emit="configer_table_remove_${l}:${a}" class="configer-table-remove">&times;</td>`,`<tr index="${a}"> ${r} </tr>`}).join("")},m=()=>{const e=[],n=window[c].querySelectorAll("tr").toArray();return t.errors=[],n.forEach(n=>{const a={},r=n.querySelectorAll("input, textarea").toArray();if(r.length!==i.length)throw swal("","config table invalid, inputs.length !== fields.length","error",{timer:1e3}),"config table invalid";r.forEach((e,n)=>{const r=i[n],o=e.value;r.regex&&!r.regex.test(o)&&t.errors.push(`${r.label}: sai định dạng ${r.regex}.test('${o}')`),a[r.key]=o}),e.push(a)}),e},p=i.map(e=>`<th>${e.label}</th>`).join(""),g=e=>{o.innerHTML=`\n        <style>\n            .configer-table {\n                border-bottom: 1px solid #ddd;\n            }\n            \n            .table.configer-table>tbody>tr>td {\n                border-top-color: #d2d2d2;\n            }\n            \n            .configer-table-field {\n                padding: 0 !important;\n            }\n            \n            \n            .configer-table-field input {\n                width: 100%;\n                border: 0;\n                padding: 8px;\n                background: #f5f5f5;\n            }\n            \n            .configer-table-field textarea {\n                width: 100%;\n                border: 0;\n                height: 100px;\n                resize: vertical;\n            }\n            \n            .configer-table-remove {\n                color: #f44336;\n                font-size: 24px;\n                font-weight: bold;\n                text-align: center;\n                cursor: pointer;\n                padding: 0 !important;\n                line-height: 36px !important;\n            }\n        </style>\n\n        <table class="table configer-table">\n            <thead>\n                <tr>\n                    <th>#</th>\n                    ${p}\n                    <th></th>\n                </tr>\n            </thead>\n\n            <tbody id="${c}">${u(e)}</tbody>\n        </table>\n        <div class="text-center">\n            <a click-emit="configer_table_add_new_${l}" class="btn btn-primary">+</a>\n            <a click-emit="configer_table_save_${l}" id="${d}" class="${n?"":"hidden"} btn btn-sm btn-success pull-right disabled">lưu</a>\n        </div>\n        `,window[c].addEventListener("keydown",()=>{t.markModified()})},f=(e,t)=>{window[c].innerHTML=u(e,1)+(t?u([{}]):"")};return r.a.listen("configer_table_add_new_"+l,()=>{const e=m();f(e,!0),t.markModified()}),r.a.listen("configer_table_remove_"+l,e=>{const n=window[c].querySelector(`[index='${e}']`);n||a.a.error("configer.table: remove row, dom not found"),window[c].removeChild(n),t.markModified()}),r.a.listen("configer_table_save_"+l,()=>{if(!n)return;let e=m();if(0!==t.errors.length)return swal("",t.errors.join("\n"),"error");t.configWillSave(e,(e,t)=>{f(e),x.set(n,e).then(()=>{h.a.push("Lưu thành công",1e3,"check text-green"),window[d].addClass("disabled"),t&&t()}).catch(a.a.error)})}),t.configWillSave=(e,t)=>t(e),t.markModified=()=>{window[d].removeClass("disabled")},t.fetch=()=>{n&&x.get(n).then(e=>{g(e)}).catch(e=>{a.a.error("configer.table: get config error",e),o.innerHTML="create config table error"})},t.getData=m,t.setData=f,n?t.fetch():g([{}]),t},text:e=>{const{name:t,target:n}=e,a={},o="configer_text_save_"+t,i="configer_text_input_"+t;return a.configWillSave=(e,t)=>t(e),x.get(t).then(e=>{n.innerHTML=`\n        <div class="form-group">\n            <textarea class="form-control"\n                style="resize: vertical; min-height: 100px; margin-bottom: 5px;"\n                id="${i}">${e||""}</textarea>\n            <button class="btn btn-success pull-right" click-emit="${o}">Lưu</button>\n        </div>\n        `,r.a.listen(o,()=>{const e=window[i].value;a.configWillSave(e,e=>{x.set(t,e).then(e=>{h.a.push("Lưu thành công",1e3,"check text-green")}).catch(e=>{swal("",e.message||e,"error")})})})}).catch(e=>{n.innerHTML=e.message||e}),a}};var T=x;const E={};E.table=({target:e,url:t,command:n,param:a,cols:o,subcriber:i,download:c,option:d}={})=>{const u=new r.a.Event,m=n?k.ui:k.get,p=s.createTimeoutCall(300),g=s.createCirleCall(),v=e.querySelectorAll("th").toArray().map(e=>({content:e.innerText,dom:e}));u.place=`${window.screen_name}_${e.id}`,u.setting=l.a["table_setting_"+u.place]||{},t=t||n,d=d||{},c=void 0===c||c,""===e.className&&(e.className="table table-bordered table-hover"),e.querySelector("thead tr").appendChild(document.createElement("th")),u.setting.hiddenCol&&Object.keys(u.setting.hiddenCol).forEach(e=>{if(u.setting.hiddenCol[e]){const t=v.findIndex(t=>t.content===e);o.splice(t,1),v[t].dom.addClass("hidden")}}),o&&(o.push(()=>{}),d.columns=o.map((e,t)=>{let n={render:(t,n,a)=>e(a)||""};return d.columns&&d.columns[t]&&(n={...n,...d.columns[t]}),n}));const b=[{defaultContent:"-",targets:"_all"},{className:"dtr-control",orderable:!1,targets:-1},{responsivePriority:10000001,targets:-1}];return d.columnDefs&&(d.columnDefs=[...b,...d.columnDefs]),u.dt=$(e).DataTable({ordering:!1,serverSide:!0,responsive:{details:{type:"column",target:-1}},columnDefs:b,oLanguage:{sInfo:"_START_ - _END_ trên _TOTAL_ bản ghi",sEmptyTable:"Không có dữ liệu hiển thị",sSearch:"",sLoadingRecords:"Đang tải dữ liệu",sProcessing:"Đang xử lý dữ liệu",sLengthMenu:"_MENU_",sInfoEmpty:"",sInfoFiltered:"",oPaginate:{sNext:"Trang sau",sPrevious:"Trang trước",sFirst:"Trang đầu",sLast:"Trang cuối"}},ajax:(e,n,r)=>{const o={offset:+e.start,limit:+e.length,search:e.search.value.split(",").map(e=>(e=e.trim(),isNaN(e)||"0"!==e[0]||(e=e.substr(1)),e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),e)).join("|"),draw:e.draw};i&&i.split(" ").forEach(e=>{o[e]=f.a[e]}),a&&Object.assign(o,"function"==typeof a?a(e):a),u.lastBody=o,m(t,o).then(t=>{t.meta=t.meta||t.metadata||{};const a={data:t.data,draw:t.meta.draw||Date.now(),recordsTotal:t.meta.total,recordsFiltered:t.meta.total};if(!a.data)return swal("Server error","Không lấy được dữ liệu từ máy chủ","error");u.onDataReceived&&u.onDataReceived(t,e),u.data=t,u.emit("receive",t,e),n(a)}).catch(k.ale)},initComplete:(e,t)=>{if(e.aanFeatures.f&&e.aanFeatures.f[0]){const t=e.aanFeatures.f[0].querySelector("input");$(t).unbind(),t.placeholder=d.searchPlaceholder||"Tìm kiếm",t.addEventListener("keyup",({target:t})=>{p.execute(()=>{e.oInstance.fnFilter(t.value)})})}const n=[];if(c&&(n.push(`<a click-emit="download_${u.iid}">Xuất dữ liệu</a>`),r.a.listen("download_"+u.iid,()=>u.emit("download"))),n.push(`<a click-emit="setting_show_${u.iid}">Cài đặt</a>`),r.a.listen("setting_show_"+u.iid,()=>u.emit("setting_show")),0!==n.length){const t=document.createElement("div");t.innerHTML=`<div class="text-right usn">${n.join(" | ")}</div>`,e.nTableWrapper.appendChild(t)}},...d}),u.reload=(e=null,t=!1)=>{g.execute(()=>{u.dt.ajax.reload(e,t)})},i&&setTimeout(()=>{r.a.listen("store_setted",({key:e,value:t,oldValue:n})=>{t!==n&&-1!==i.split(" ").indexOf(e)&&u.reload()})}),u.listen("download",()=>swal("Xuất dữ liệu",`Xuất toàn bộ ${u.data.meta.total} dòng trên bảng`,{buttons:!0}).then(e=>{if(!e)return;const n=[],a={offset:0,limit:24,total:u.data.meta.total,headers:u.dt.table().header().querySelectorAll("th").toArray().map(e=>e.innerText),renders:[...o],name:"dc-portal-download",warm:0},r=()=>{const e={...u.lastBody,offset:a.offset,limit:a.limit};a.offset>a.total&&(a.offset=a.total);const o={progMessage:`Đang xuất dữ liệu (${a.offset+a.limit}/${a.total})`};m(t,e,o).then(({data:e})=>{(e=>{e.forEach((e,t)=>{n.push(a.headers.map((n,r)=>{const o=document.createElement("div");return o.innerHTML=a.renders[r]&&a.renders[r](e,a,t)||"",o.innerText.trim()}))})})(e),e&&a.offset+a.limit<a.total?(a.offset+=a.limit,a.offset>a.total&&(a.offset=a.total),0===a.warm&&(a.warm=1,setTimeout(()=>{a.warm=2},12e3)),2===a.warm?(h.a.push(`Cooling down... Wait for a while (${a.offset+a.limit}/${a.total})`,3e3),a.warm=0,setTimeout(r,3e3)):setTimeout(r)):(s.export(n,`${a.name}-${moment().format("YYYY-MM-DD-HHmmss")}`),h.a.success(`Xuất ${a.total} bản ghi thành công`,2e3))}).catch(k.ale)};"function"==typeof c&&c(a),n.push([...a.headers]),r()})),u.listen("setting_show",()=>{const e=`\n        <div class="form-group">\n            <label>Danh sách cột hiển thị</label>\n            <br>\n            ${v.filter(e=>e.content).map(e=>`\n            <label class="cup" style="font-weight: normal">\n                <input\n                    data-table-setting-${u.iid}\n                    name="${e.content}"\n                    type="checkbox" ${u.setting.hiddenCol&&u.setting.hiddenCol[e.content]?"":"checked"}\n                > ${e.content}\n            </label>`).join("<br>")}\n        </div>\n\n        <div class="text-right mt30">\n            <a class="btn btn-success" click-emit="setting_save_${u.iid}">Lưu</a>\n        </div>\n        `;r.a.emit("simple_modal_show",{title:"",body:e})}),r.a.listen("setting_save_"+u.iid,()=>{u.setting.hiddenCol=u.setting.hiddenCol||{};document.querySelectorAll(`input[data-table-setting-${u.iid}]`).toArray().forEach(e=>{u.setting.hiddenCol[e.name]=!e.checked});l.a["table_setting_"+u.place]=u.setting,location.reload()}),u},E.address=({target:e,option:t,recent:n,fixs:a})=>{t=t||{},n=void 0===n||n;const o=new r.a.Event,i=s.createTimeoutCall(300);return o.sessiontoken=Date.now(),$(e).select2({placeholder:"Nhập địa chỉ để tìm kiếm...",minimumInputLength:2,ajax:{transport:(e,n,a)=>(i.execute(()=>{k.get("/map/v1/places/autocomplete",{query:e.data.q,sessiontoken:o.sessiontoken,components:void 0!==t.components?t.components:void 0}).then(({data:e})=>n({results:e.map(e=>({id:e.place_id,text:e.description}))})).catch(a)}),{})},...t}),$(e).on("select2:select",e=>{k.get("/map/v1/geocode",{placeID:e.params.data.id,sessiontoken:o.sessiontoken}).then(({data:e})=>{o.value=e,o.data=e,o.sessiontoken=Date.now(),o.onChange&&o.onChange(e),o.emit("change",e);const t=l.a.wrapper_address_recents||[];t.find(t=>t.place_id===e.place_id)||(t.unshift(e),t.length>12&&t.shift(),l.a.wrapper_address_recents=t)})}),$(e).on("select2:open",t=>{n&&setTimeout(()=>{const t=(a||[]).concat(l.a.wrapper_address_recents).filter(e=>e);t.length&&(document.querySelector(".select2-results__options").innerHTML=t.map(e=>`<div class="wrapper-address-i" click-emit="wrapper_address_pick:${e.place_id}">${e.formatted_address}</div>`).join(""),r.a.listen("wrapper_address_pick",n=>{o.set(t.find(e=>e.place_id===n)),$(e).select2("close")},"select2:open"))},0),o.emit("open")}),$(e).on("select2:unselect",e=>{o.value=null,o.data=null,o.next("change",o.value)}),o.set=t=>{if(!t)return $(e).val(null).trigger("change"),void(o.data=null);const n=t=>{o.value=t,o.data=t,$(e).empty().append($("<option/>").val(t.place_id).text(t.formatted_address)).val(t.place_id).trigger("change"),o.onChange&&o.onChange(t),o.emit("change",t)};return"object"==typeof t?n(t):k.get("/map/v1/geocode",{placeID:t}).then(({data:e})=>n(e))},o},E.datetime=({target:e,option:t})=>{const n=new r.a.Event;e.autocomplete="off",$(e).datetimepicker({format:"d/m/Y H:i",lang:"vi",closeOnTimeSelect:!0,onChangeDateTime:(e,t)=>{const a=moment(e);a._isValid&&(n.value=a),n.text=t.val(),n.onChange&&n.onChange(n.value),n.emit("change",n.value)},...t}),n.set=t=>{if(!t)return $(e).val(null).trigger("change"),void(n.value=null);e.value=moment.utc(t).local().format("HH:mm DD/MM/YYYY");const a=moment(t);a._isValid&&(n.value=a),n.emit("change",t)};const a=e.getAttribute("store-bind");return a&&(f.a[a]=e.value||"",n.listen("change",()=>{f.a[a]=e.value||""})),n},E.daterange=({target:e,option:t,empty:n})=>{const a=new r.a.Event;t=t||{},e.setAttribute("autocomplete","off"),e.setAttribute("class","form-control form-chevron-down"),a.option={timePicker:!1,startDate:moment().subtract(30,"days"),locale:{format:"DD/MM/YYYY"},ranges:{Today:[moment(),moment()],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],"This Year":[moment().startOf("year"),moment().endOf("year")],"Last Year":[moment().subtract(1,"year").startOf("year"),moment().subtract(1,"year").endOf("year")]}},t.timePicker&&(a.option.timePickerIncrement=10,a.option.locale.format="HH:mm "+a.option.locale.format),$(e).daterangepicker({...a.option,...t},(e,t)=>{a.value={start:e,end:t},a.next("change",a.value)}),n?$(e).val("Tất cả"):a.value={start:$(e).data("daterangepicker").startDate,end:$(e).data("daterangepicker").endDate};const o=e.getAttribute("store-bind");return o&&(f.a[o]=$(e).val(),a.listen("change",()=>{f.a[o]=$(e).val()})),a},E.select=({target:e,url:t,command:n,param:a,option:o})=>{const i=new r.a.Event,l=n?k.ui:k.get,c=s.createTimeoutCall(300);i.target=e,i.multiple=null!==e.getAttribute("multiple"),t=t||n,o=o||{};const d={allowClear:!0,...o};t&&(d.ajax={transport:(e,n,r)=>(c.execute(()=>{const o={search:e.data.q};a&&Object.assign(o,"function"==typeof a?a(e):a),l(t,o).then(({data:e})=>{n({results:e})}).catch(r)}),{})},d.minimumInputLength=1,d.placeholder="Nhập để tìm kiếm..."),$(e).select2(d),i.value=$(e).val(),$(e).on("select2:select",t=>{i.multiple?Array.isArray(i.data)?i.data.push(t.params.data):i.data=[t.params.data]:i.data=t.params.data,i.value=$(e).val(),i.emit("change",i.value)}),$(e).on("select2:unselect",t=>{i.multiple&&Array.isArray(i.data)?i.data.splice(i.data.find(e=>e.id===t.params.data.id||t.params.data),1):i.data=null,i.value=$(e).val(),i.next("change",i.value)});const u=e.getAttribute("store-bind");return!i.multiple&&u&&(f.a[u]=$(e).val()||"",i.listen("change",()=>{f.a[u]=$(e).val()||""})),i.set=t=>{setTimeout(()=>{if(null==t)return $(e).val(null).trigger("change"),i.value=null,void(i.data=null);t&&"object"==typeof t&&t.id?($(e).empty().append($("<option/>").val(t.id).text(t.text)).val(t.id).trigger("change"),i.value=t.id,i.data=t,i.emit("change",t.id)):(Array.isArray(t)&&(i.data=t,t.forEach(t=>{e.querySelector(`option[value="${t.id||t}"]`)||(e.innerHTML+=`<option value="${t.id||t}">${t.text||t}</option>`)})),$(e).val(t.map(e=>e.id||e)).trigger("change"),i.value=t.map(e=>e.id||e))})},i},E.tag=({target:e,init:t,storeKey:n})=>{const a=new r.a.Event;return a.ops=t?t.replace(/ *(,) */g,"$1").split(",").map(e=>({value:e,active:!1})):[],a.render=()=>{const t=a.ops.map(e=>`\n            <span class="wt-item${e.active?" wt-active":""}"\n                click-emit="wt_${a.uuid}_select:${e.value}"\n            >${e.value}</span>`).join("");e.innerHTML=`<div class="wt-box">${t}</div>`},a.set=e=>{(e="string"==typeof e?e.replace(/ *(,) */g,"$1").split(","):e.map(e=>e.trim())).forEach(e=>{const t=a.ops.find(t=>t.value===e);t?t.active=!0:a.ops.push({value:e,active:!0}),a.render()}),a.value=a.ops.filter(e=>e.active).map(e=>e.value).join(","),a.emit("change")},r.a.listen(`wt_${a.uuid}_select`,(e,{target:t})=>{const n=a.ops.find(t=>t.value===e);n.active?t.removeClass("wt-active"):t.addClass("wt-active"),n.active=!n.active,a.value=a.ops.filter(e=>e.active).map(e=>e.value).join(","),a.emit("change")}),n&&(f.a[n]=a.value,a.listen("change",()=>{f.a[n]=a.value})),a.render(),a};var L=E;const C={setting:{},html:(e,...t)=>{let n="";t.push(""),e.forEach((e,a)=>{let r=t[a],o="";(r instanceof HTMLCollection||r instanceof NodeList)&&(r=[...r]),Array.isArray(r)||(r=[r]),r.forEach(e=>{e instanceof HTMLElement?o+=e.outerHTML:o+=e}),n+=e+o});const r=document.createElement("div");return r.innerHTML=n,0===r.childElementCount?(a.a.error("dom.html: dom must has only on child"),document.createElement("div")):r.childElementCount>1?r:r.firstElementChild},raw:(e,...t)=>C.html(e,...t).outerHTML,render:(e,t)=>{Array.isArray(e)||(e=[e]),"string"==typeof value?t.innerHTML=value:value instanceof HTMLElement&&(t.innerHTML="",t.appendChild(value))}};var A=C;const S={pools:[],ready:e=>{if("complete"===document.readyState||"interactive"===document.readyState)return e(ori);document.addEventListener("DOMContentLoaded",()=>{e(ori)})},use:(e,t)=>{const n=e.split(" ").map(e=>e.trim()).filter(e=>e);o.a.script(n.filter(e=>!ori[e])).then(()=>{n.forEach(e=>{window[e]=ori[e]}),S.ready(t)})},push:(e,t,n={})=>{S.pools.push({shard:e,handle:t,priority:n.priority||0})},execute:()=>{S.pools.sort((e,t)=>e.priority-t.priority).forEach(e=>{ori.use(e.shard,e.handle)})}};var M=S;window.ori={},c(),ori.event=r.a,ori.storage=l.a,ori.config=u,ori.logger=a.a,ori.emitter=g,ori.include=o.a,ori.configer=T,ori.store=f.a,ori.util=s,ori.init=c,ori.bus=k,ori.wrapper=L,ori.prog=h.a,ori.dom=A,ori.activity=b,ori.order=M,ori.use=M.use,ori.ready=M.ready},9:function(e,t,n){"use strict";var a=n(1),r=n(2),o=n(10);const i=["origin","layer"],s=["INPUT","TEXTAREA","SELECT"],l={state:{},subs:[],layer:{},scan:e=>{const t=document.querySelector(`[store-bind="${e}"]`);if(!t)return a.a.error("store: store.origin.scan, key not found",e),"";const n=t.tagName,r=t.getAttribute("store-ta");return r?"innerHTML"===r?t.innerHTML:t.getAttribute(r):-1!==s.indexOf(n)?"checkbox"===t.type||"radio"===t.type?t.checked:t.value:"IMG"===n?t.src:t.innerHTML}},c={get:(e,t)=>"origin"===t?e:"layer"===t?e.layer:e.state[t],set:(e,t,n)=>{if(-1!==i.indexOf(t))return a.a.error("store: key can not use",t);let o={};if("object"==typeof n&&null!==n){if(void 0===n.value)return a.a.error("store: complex value invalid, { value, ta (target attribute), ... }, received:",n);o=n,n=n.value}document.querySelectorAll(`[store-bind="${t}"]`).toArray().forEach(e=>{const t=e.tagName,a=o.ta||e.getAttribute("store-ta");a?"innerHTML"===a?e.innerHTML=n:"outerHTML"===a?e.outerHTML=n:e.setAttribute(a,n):-1!==s.indexOf(t)?"checkbox"===e.type||"radio"===e.type?e.checked=n:e.value=n:"IMG"===t?e.src=n:e.innerHTML=n});const l=e.state[t];return e.state[t]=n,void 0!==e.layer[t]&&(e.layer[t]=n),r.a.emit("store_setted",{key:t,value:n,oldValue:l,...o}),!0}},d=({target:e})=>{const t=e.getAttribute("store-bind");let n=null;null!==e.getAttribute("layer")&&(l.layer[t]=n),"checkbox"===e.type?n=e.checked:"radio"===e.type||(n=e.value),c.set(l,t,n)};l.watch=(e={loadValue:!0})=>{0!==l.subs.length&&l.subs.forEach(e=>{e.removeEventListener("change",d)});document.querySelectorAll("input[store-bind], textarea[store-bind], select[store-bind]").toArray().forEach(t=>{l.subs.push(t);(t.getAttribute("store-event")||"change").split(" ").forEach(e=>{t.addEventListener(e,d)}),e.loadValue&&d({target:t})})},l.share=(...e)=>{if(!e)return;const t={persistent:!1};"object"==typeof e[e.length-1]&&Object.asign(t,e.pop());const n=location.hash.slice(1)||o.a["store_share:"+window.screen_name];let a={};n.startsWith("ss_")&&(a=JSON.parse(atob(n.slice(3))),Object.keys(a).forEach(e=>{c.set(l,e,a[e])})),r.a.listen("store_setted",({key:t,value:n})=>{if(-1!==e.indexOf(t)){a[t]=n;const e="ss_"+btoa(JSON.stringify(a));location.hash=e,o.a["store_share:"+window.screen_name]=e}})};const u=new Proxy(l,c);t.a=u}});
